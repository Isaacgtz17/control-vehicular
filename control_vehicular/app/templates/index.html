{% extends "base_admin.html" %} {% block title %}Dashboard Principal{% endblock
%} {% block content %}
<!-- SECCIÓN DE REGISTRO -->
<div class="bg-white p-6 rounded-lg shadow-md mb-8">
  <h2 class="text-2xl font-semibold mb-4">Registrar Nuevo Vehículo</h2>
  <form action="{{ url_for('main.registrar_vehiculo') }}" method="post">
    <div class="grid md:grid-cols-3 gap-4 mb-4">
      <input
        type="text"
        name="placa"
        placeholder="Placa del Vehículo"
        required
        class="p-2 border rounded w-full"
      />
      <input
        type="text"
        name="modelo"
        placeholder="Modelo (Ej: Ford Focus)"
        required
        class="p-2 border rounded w-full"
      />
      <input
        type="text"
        name="conductor"
        placeholder="Nombre del Conductor"
        required
        class="p-2 border rounded w-full"
      />
    </div>
    <button
      type="submit"
      class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors"
    >
      Registrar Vehículo
    </button>
  </form>
</div>

<!-- Sección de Bitácora de Accesos (AHORA ESTÁ AQUÍ) -->
<div class="bg-white p-6 rounded-lg shadow-md mb-8">
  <div class="flex flex-col md:flex-row justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold">Bitácora de Accesos</h2>
    <form
      action="{{ url_for('main.index') }}"
      method="get"
      class="flex items-center mt-4 md:mt-0"
    >
      <input
        type="search"
        name="q_bitacora"
        value="{{ q_bitacora or '' }}"
        placeholder="Buscar en bitácora..."
        class="p-2 border rounded-l-md"
      />
      <button
        type="submit"
        class="bg-gray-600 text-white p-2 rounded-r-md hover:bg-gray-700"
      >
        Buscar
      </button>
    </form>
  </div>
  <div class="overflow-x-auto">
    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="bg-gray-200">
          <th class="p-2 border">Fecha y Hora</th>
          <th class="p-2 border">Tipo</th>
          <th class="p-2 border">Placa</th>
          <th class="p-2 border">Modelo</th>
          <th class="p-2 border">Conductor</th>
        </tr>
      </thead>
      <tbody>
        {% for registro in registros.items %}
        <tr class="hover:bg-gray-50">
          <td class="p-2 border">
            {{ registro.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
          </td>
          <td class="p-2 border">
            {% if registro.tipo == 'Entrada' %}<span
              class="text-green-600 font-bold"
              >{{ registro.tipo }}</span
            >{% else %}<span class="text-red-600 font-bold"
              >{{ registro.tipo }}</span
            >{% endif %}
          </td>
          <td class="p-2 border">{{ registro.vehiculo.placa }}</td>
          <td class="p-2 border">{{ registro.vehiculo.modelo }}</td>
          <td class="p-2 border">{{ registro.vehiculo.conductor }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <!-- Paginación para bitácora -->
  <div class="mt-4">
    {% if registros.has_prev %}<a
      href="{{ url_for('main.index', page=registros.prev_num) }}"
      class="px-3 py-1 bg-gray-200 rounded"
      >&laquo; Anterior</a
    >{% endif %} Página {{ registros.page }} de {{ registros.pages }}. {% if
    registros.has_next %}<a
      href="{{ url_for('main.index', page=registros.next_num) }}"
      class="px-3 py-1 bg-gray-200 rounded"
      >Siguiente &raquo;</a
    >{% endif %}
  </div>
</div>

<!-- Sección de Vehículos Registrados (AHORA ESTÁ AL FINAL) -->
<div class="bg-white p-6 rounded-lg shadow-md">
  <div class="flex flex-col md:flex-row justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold">Vehículos Registrados</h2>
    <form
      action="{{ url_for('main.index') }}"
      method="get"
      class="flex items-center mt-4 md:mt-0"
    >
      <input
        type="search"
        name="q_vehiculo"
        value="{{ q_vehiculo or '' }}"
        placeholder="Buscar vehículos..."
        class="p-2 border rounded-l-md"
      />
      <button
        type="submit"
        class="bg-gray-600 text-white p-2 rounded-r-md hover:bg-gray-700"
      >
        Buscar
      </button>
    </form>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for vehiculo in vehiculos.items %}
    <div
      class="border p-4 rounded-lg bg-gray-50 flex flex-col items-center text-center shadow"
    >
      <p class="font-bold text-lg">{{ vehiculo.placa }}</p>
      <div class="mt-1 mb-1">
        {% if vehiculo.status == 'adentro' %}<span
          class="px-3 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded-full"
          >ADENTRO</span
        >{% else %}<span
          class="px-3 py-1 text-xs font-semibold text-gray-800 bg-gray-200 rounded-full"
          >AFUERA</span
        >{% endif %}
      </div>
      <p>{{ vehiculo.modelo }}</p>
      <p class="text-sm text-gray-600 mb-2">{{ vehiculo.conductor }}</p>
      <img
        src="data:image/png;base64,{{ vehiculo.qr_code_b64 }}"
        alt="QR"
        class="mt-2 w-32 h-32"
      />
      <div class="grid grid-cols-3 gap-2 mt-4 w-full">
        <a
          href="{{ url_for('main.descargar_qr', vehiculo_id=vehiculo.id) }}"
          class="flex items-center justify-center bg-green-500 text-white p-2 rounded-md hover:bg-green-600 text-xs"
          >Descargar</a
        >
        <a
          href="{{ url_for('main.editar_vehiculo', vehiculo_id=vehiculo.id) }}"
          class="flex items-center justify-center bg-yellow-500 text-white p-2 rounded-md hover:bg-yellow-600 text-xs"
          >Editar</a
        >
        <form
          action="{{ url_for('main.eliminar_vehiculo', vehiculo_id=vehiculo.id) }}"
          method="post"
          onsubmit="return confirm('¿Seguro?');"
        >
          <button
            type="submit"
            class="w-full bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs"
          >
            Eliminar
          </button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
  <!-- Paginación para vehículos -->
  <div class="mt-4">
    {% if vehiculos.has_prev %}<a
      href="{{ url_for('main.index', page=vehiculos.prev_num) }}"
      class="px-3 py-1 bg-gray-200 rounded"
      >&laquo; Anterior</a
    >{% endif %} Página {{ vehiculos.page }} de {{ vehiculos.pages }}. {% if
    vehiculos.has_next %}<a
      href="{{ url_for('main.index', page=vehiculos.next_num) }}"
      class="px-3 py-1 bg-gray-200 rounded"
      >Siguiente &raquo;</a
    >{% endif %}
  </div>
</div>
{% endblock %}
